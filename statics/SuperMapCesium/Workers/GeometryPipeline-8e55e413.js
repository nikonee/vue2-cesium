/**
 * Cesium - https://github.com/CesiumGS/cesium
 *
 * Copyright 2011-2020 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/master/LICENSE.md for full licensing details.
 */
define(["exports","./when-8d13db60","./Check-70bec281","./Math-61ede240","./Cartographic-f27b0939","./Cartesian2-09435a6c","./BoundingSphere-c409f092","./Cartesian4-5af5bb24","./ComponentDatatype-5862616f","./GeometryAttribute-2243653a","./PrimitiveType-97893bc7","./AttributeCompression-75ce15eb","./EncodedCartesian3-87cd0c1f","./IndexDatatype-9435b55f","./IntersectionTests-dbfba52c","./Plane-2bcb9154"],function(e,Z,M,H,W,X,x,j,q,R,B,E,v,P,J,i){var A=new W.Cartesian3,D=new W.Cartesian3,S=new W.Cartesian3;var s={calculateACMR:function(e){var t=(e=Z.defaultValue(e,Z.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,i=Z.defaultValue(e.cacheSize,24);if(!Z.defined(t))throw new M.DeveloperError("indices is required.");var a=t.length;if(a<3||a%3!=0)throw new M.DeveloperError("indices length must be a multiple of three.");if(r<=0)throw new M.DeveloperError("maximumIndex must be greater than zero.");if(i<3)throw new M.DeveloperError("cacheSize must be greater than two.");if(!Z.defined(r))for(var n=r=0,s=t[n];n<a;)r<s&&(r=s),s=t[++n];for(var o=[],u=0;u<r+1;u++)o[u]=0;for(var p=i+1,d=0;d<a;++d)p-o[t[d]]>i&&(o[t[d]]=p,++p);return(p-i+1)/(a/3)}};s.tipsify=function(e){var l,t=(e=Z.defaultValue(e,Z.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,i=Z.defaultValue(e.cacheSize,24);function a(e,t,r,i,a,n,s){for(var o,u=-1,p=-1,d=0;d<r.length;){var v=r[d];i[v].numLiveTriangles&&(o=0,a-i[v].timeStamp+2*i[v].numLiveTriangles<=t&&(o=a-i[v].timeStamp),(p<o||-1===p)&&(p=o,u=v)),++d}return-1===u?function(e,t,r,i){for(;1<=t.length;){var a=t[t.length-1];if(t.splice(t.length-1,1),0<e[a].numLiveTriangles)return a}for(;l<i;){if(0<e[l].numLiveTriangles)return++l-1;++l}return-1}(i,n,0,s):u}if(!Z.defined(t))throw new M.DeveloperError("indices is required.");var n=t.length;if(n<3||n%3!=0)throw new M.DeveloperError("indices length must be a multiple of three.");if(r<=0)throw new M.DeveloperError("maximumIndex must be greater than zero.");if(i<3)throw new M.DeveloperError("cacheSize must be greater than two.");var s=0,o=0,u=t[o],p=n;if(Z.defined(r))s=r+1;else{for(;o<p;)s<u&&(s=u),u=t[++o];if(-1===s)return 0;++s}var d,v=[];for(d=0;d<s;d++)v[d]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};for(var f=o=0;o<p;)v[t[o]].vertexTriangles.push(f),++v[t[o]].numLiveTriangles,v[t[o+1]].vertexTriangles.push(f),++v[t[o+1]].numLiveTriangles,v[t[o+2]].vertexTriangles.push(f),++v[t[o+2]].numLiveTriangles,++f,o+=3;var m=0,y=i+1;l=1;var c,h,C,b,w=[],g=[],T=0,A=[],E=n/3,D=[];for(d=0;d<E;d++)D[d]=!1;for(;-1!==m;){w=[],b=(h=v[m]).vertexTriangles.length;for(var x=0;x<b;++x)if(!D[f=h.vertexTriangles[x]]){D[f]=!0,o=f+f+f;for(var P=0;P<3;++P)C=t[o],w.push(C),g.push(C),A[T]=C,++T,--(c=v[C]).numLiveTriangles,y-c.timeStamp>i&&(c.timeStamp=y,++y),++o}m=a(0,i,w,v,y,g,s)}return A};var t={};function o(e,t,r,i,a){e[t++]=r,e[t++]=i,e[t++]=i,e[t++]=a,e[t++]=a,e[t]=r}function m(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&Z.defined(e[r])&&Z.defined(e[r].values)){var i=e[r];t[r]=new R.GeometryAttribute({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return t}function y(e,t,r){for(var i in t)if(t.hasOwnProperty(i)&&Z.defined(t[i])&&Z.defined(t[i].values))for(var a=t[i],n=0;n<a.componentsPerAttribute;++n)e[i].values.push(a.values[r*a.componentsPerAttribute+n])}t.toWireframe=function(e){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");var t=e.indices;if(Z.defined(t)){switch(e.primitiveType){case B.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,i=P.IndexDatatype.createTypedArray(t,r),a=0,n=0;n<t;n+=3,a+=6)o(i,a,e[n],e[n+1],e[n+2]);return i}(t);break;case B.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(3<=t){var r=6*(t-2),i=P.IndexDatatype.createTypedArray(t,r);o(i,0,e[0],e[1],e[2]);for(var a=6,n=3;n<t;++n,a+=6)o(i,a,e[n-1],e[n],e[n-2]);return i}return new Uint16Array}(t);break;case B.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(0<e.length){for(var t=e.length-1,r=6*(t-1),i=P.IndexDatatype.createTypedArray(t,r),a=e[0],n=0,s=1;s<t;++s,n+=6)o(i,n,a,e[s],e[s+1]);return i}return new Uint16Array}(t);break;default:throw new M.DeveloperError("geometry.primitiveType must be TRIANGLES, TRIANGLE_STRIP, or TRIANGLE_FAN.")}e.primitiveType=B.PrimitiveType.LINES}return e},t.createLineSegmentsForVectors=function(e,t,r){if(t=Z.defaultValue(t,"normal"),!Z.defined(e))throw new M.DeveloperError("geometry is required.");if(!Z.defined(e.attributes.position))throw new M.DeveloperError("geometry.attributes.position is required.");if(!Z.defined(e.attributes[t]))throw new M.DeveloperError("geometry.attributes must have an attribute with the same name as the attributeName parameter, "+t+".");r=Z.defaultValue(r,1e4);for(var i,a=e.attributes.position.values,n=e.attributes[t].values,s=a.length,o=new Float64Array(2*s),u=0,p=0;p<s;p+=3)o[u++]=a[p],o[u++]=a[p+1],o[u++]=a[p+2],o[u++]=a[p]+n[p]*r,o[u++]=a[p+1]+n[p+1]*r,o[u++]=a[p+2]+n[p+2]*r;var d=e.boundingSphere;return Z.defined(d)&&(i=new x.BoundingSphere(d.center,d.radius+r)),new R.Geometry({attributes:{position:new R.GeometryAttribute({componentDatatype:q.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:o})},primitiveType:B.PrimitiveType.LINES,boundingSphere:i})},t.createAttributeLocations=function(e){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");var t,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],i=e.attributes,a={},n=0,s=r.length;for(t=0;t<s;++t){var o=r[t];Z.defined(i[o])&&(a[o]=n++)}for(var u in i)i.hasOwnProperty(u)&&!Z.defined(a[u])&&(a[u]=n++);return a},t.reorderForPreVertexCache=function(e){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");var t=R.Geometry.computeNumberOfVertices(e),r=e.indices;if(Z.defined(r)){for(var i=new Int32Array(t),a=0;a<t;a++)i[a]=-1;for(var n,s=r,o=s.length,u=P.IndexDatatype.createTypedArray(t,o),p=0,d=0,v=0;p<o;)-1!==(n=i[s[p]])?u[d]=n:(i[n=s[p]]=v,u[d]=v,++v),++p,++d;e.indices=u;var l=e.attributes;for(var f in l)if(l.hasOwnProperty(f)&&Z.defined(l[f])&&Z.defined(l[f].values)){for(var m=l[f],y=m.values,c=0,h=m.componentsPerAttribute,C=q.ComponentDatatype.createTypedArray(m.componentDatatype,v*h);c<t;){var b=i[c];if(-1!==b)for(var w=0;w<h;w++)C[h*b+w]=y[h*c+w];++c}m.values=C}}return e},t.reorderForPostVertexCache=function(e,t){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");var r=e.indices;if(e.primitiveType===B.PrimitiveType.TRIANGLES&&Z.defined(r)){for(var i=r.length,a=0,n=0;n<i;n++)r[n]>a&&(a=r[n]);e.indices=s.tipsify({indices:r,maximumIndex:a,cacheSize:t})}return e},t.fitToUnsignedShortIndices=function(e){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");if(Z.defined(e.indices)&&e.primitiveType!==B.PrimitiveType.TRIANGLES&&e.primitiveType!==B.PrimitiveType.LINES&&e.primitiveType!==B.PrimitiveType.POINTS)throw new M.DeveloperError("geometry.primitiveType must equal to PrimitiveType.TRIANGLES, PrimitiveType.LINES, or PrimitiveType.POINTS.");var t=[],r=R.Geometry.computeNumberOfVertices(e);if(Z.defined(e.indices)&&r>=H.CesiumMath.SIXTY_FOUR_KILOBYTES){var i,a=[],n=[],s=0,o=m(e.attributes),u=e.indices,p=u.length;e.primitiveType===B.PrimitiveType.TRIANGLES?i=3:e.primitiveType===B.PrimitiveType.LINES?i=2:e.primitiveType===B.PrimitiveType.POINTS&&(i=1);for(var d=0;d<p;d+=i){for(var v=0;v<i;++v){var l=u[d+v],f=a[l];Z.defined(f)||(f=s++,a[l]=f,y(o,e.attributes,l)),n.push(f)}s+i>=H.CesiumMath.SIXTY_FOUR_KILOBYTES&&(t.push(new R.Geometry({attributes:o,indices:n,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),a=[],n=[],s=0,o=m(e.attributes))}0!==n.length&&t.push(new R.Geometry({attributes:o,indices:n,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var c=new W.Cartesian3,h=new W.Cartographic;t.projectTo2D=function(e,t,r,i,a){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");if(!Z.defined(t))throw new M.DeveloperError("attributeName is required.");if(!Z.defined(r))throw new M.DeveloperError("attributeName3D is required.");if(!Z.defined(i))throw new M.DeveloperError("attributeName2D is required.");if(!Z.defined(e.attributes[t]))throw new M.DeveloperError("geometry must have attribute matching the attributeName argument: "+t+".");if(e.attributes[t].componentDatatype!==q.ComponentDatatype.DOUBLE)throw new M.DeveloperError("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");for(var n=e.attributes[t],s=(a=Z.defined(a)?a:new x.GeographicProjection).ellipsoid,o=n.values,u=new Float64Array(o.length),p=0,d=0;d<o.length;d+=3){var v=W.Cartesian3.fromArray(o,d,c),l=s.cartesianToCartographic(v,h);if(!Z.defined(l))throw new M.DeveloperError("Could not project point ("+v.x+", "+v.y+", "+v.z+") to 2D.");var f=a.project(l,c);u[p++]=f.x,u[p++]=f.y,u[p++]=f.z}return e.attributes[r]=n,e.attributes[i]=new R.GeometryAttribute({componentDatatype:q.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:u}),delete e.attributes[t],e};var l={high:0,low:0};t.encodeAttribute=function(e,t,r,i){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");if(!Z.defined(t))throw new M.DeveloperError("attributeName is required.");if(!Z.defined(r))throw new M.DeveloperError("attributeHighName is required.");if(!Z.defined(i))throw new M.DeveloperError("attributeLowName is required.");if(!Z.defined(e.attributes[t]))throw new M.DeveloperError("geometry must have attribute matching the attributeName argument: "+t+".");if(e.attributes[t].componentDatatype!==q.ComponentDatatype.DOUBLE)throw new M.DeveloperError("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");for(var a=e.attributes[t],n=a.values,s=n.length,o=new Float32Array(s),u=new Float32Array(s),p=0;p<s;++p)v.EncodedCartesian3.encode(n[p],l),o[p]=l.high,u[p]=l.low;var d=a.componentsPerAttribute;return e.attributes[r]=new R.GeometryAttribute({componentDatatype:q.ComponentDatatype.FLOAT,componentsPerAttribute:d,values:o}),e.attributes[i]=new R.GeometryAttribute({componentDatatype:q.ComponentDatatype.FLOAT,componentsPerAttribute:d,values:u}),delete e.attributes[t],e};var n=new W.Cartesian3;function a(e,t){if(Z.defined(t))for(var r=t.values,i=r.length,a=0;a<i;a+=3)W.Cartesian3.unpack(r,a,n),x.Matrix4.multiplyByPoint(e,n,n),W.Cartesian3.pack(n,r,a)}function u(e,t){if(Z.defined(t))for(var r=t.values,i=r.length,a=0;a<i;a+=3)W.Cartesian3.unpack(r,a,n),x.Matrix3.multiplyByVector(e,n,n),n=W.Cartesian3.normalize(n,n),W.Cartesian3.pack(n,r,a)}var p=new x.Matrix4,d=new x.Matrix3;t.transformToWorldCoordinates=function(e){if(!Z.defined(e))throw new M.DeveloperError("instance is required.");var t=e.modelMatrix;if(x.Matrix4.equals(t,x.Matrix4.IDENTITY))return e;var r=e.geometry.attributes;a(t,r.position),a(t,r.prevPosition),a(t,r.nextPosition),(Z.defined(r.normal)||Z.defined(r.tangent)||Z.defined(r.bitangent))&&(x.Matrix4.inverse(t,p),x.Matrix4.transpose(p,p),x.Matrix4.getRotation(p,d),u(d,r.normal),u(d,r.tangent),u(d,r.bitangent));var i=e.geometry.boundingSphere;return Z.defined(i)&&(e.geometry.boundingSphere=x.BoundingSphere.transform(i,t,i)),e.modelMatrix=x.Matrix4.clone(x.Matrix4.IDENTITY),e};var I=new W.Cartesian3;function f(e,t){var r,i,a,n,s=e.length,o=e[0].modelMatrix,u=Z.defined(e[0][t].indices),p=e[0][t].primitiveType;for(i=1;i<s;++i){if(!x.Matrix4.equals(e[i].modelMatrix,o))throw new M.DeveloperError("All instances must have the same modelMatrix.");if(Z.defined(e[i][t].indices)!==u)throw new M.DeveloperError("All instance geometries must have an indices or not have one.");if(e[i][t].primitiveType!==p)throw new M.DeveloperError("All instance geometries must have the same primitiveType.")}var d,v,l,f,m=function(e,t){var r,i=e.length,a={},n=e[0][t].attributes;for(r in n)if(n.hasOwnProperty(r)&&Z.defined(n[r])&&Z.defined(n[r].values)){for(var s=n[r],o=s.values.length,u=!0,p=1;p<i;++p){var d=e[p][t].attributes[r];if(!Z.defined(d)||s.componentDatatype!==d.componentDatatype||s.componentsPerAttribute!==d.componentsPerAttribute||s.normalize!==d.normalize){u=!1;break}o+=d.values.length}u&&(a[r]=new R.GeometryAttribute({componentDatatype:s.componentDatatype,componentsPerAttribute:s.componentsPerAttribute,normalize:s.normalize,values:q.ComponentDatatype.createTypedArray(s.componentDatatype,o)}))}return a}(e,t);for(r in m)if(m.hasOwnProperty(r))for(d=m[r].values,i=n=0;i<s;++i)for(l=(v=e[i][t].attributes[r].values).length,a=0;a<l;++a)d[n++]=v[a];if(u){var y=0;for(i=0;i<s;++i)y+=e[i][t].indices.length;var c=R.Geometry.computeNumberOfVertices(new R.Geometry({attributes:m,primitiveType:B.PrimitiveType.POINTS})),h=P.IndexDatatype.createTypedArray(c,y),C=0,b=0;for(i=0;i<s;++i){var w=e[i][t].indices,g=w.length;for(n=0;n<g;++n)h[C++]=b+w[n];b+=R.Geometry.computeNumberOfVertices(e[i][t])}f=h}var T,A=new W.Cartesian3,E=0;for(i=0;i<s;++i){if(T=e[i][t].boundingSphere,!Z.defined(T)){A=void 0;break}W.Cartesian3.add(T.center,A,A)}if(Z.defined(A))for(W.Cartesian3.divideByScalar(A,s,A),i=0;i<s;++i){T=e[i][t].boundingSphere;var D=W.Cartesian3.magnitude(W.Cartesian3.subtract(T.center,A,I))+T.radius;E<D&&(E=D)}return new R.Geometry({attributes:m,indices:f,primitiveType:p,boundingSphere:Z.defined(A)?new x.BoundingSphere(A,E):void 0})}t.combineInstances=function(e){if(!Z.defined(e)||e.length<1)throw new M.DeveloperError("instances is required and must have length greater than zero.");for(var t=[],r=[],i=e.length,a=0;a<i;++a){var n=e[a];Z.defined(n.geometry)?t.push(n):Z.defined(n.westHemisphereGeometry)&&Z.defined(n.eastHemisphereGeometry)&&r.push(n)}var s=[];return 0<t.length&&s.push(f(t,"geometry")),0<r.length&&(s.push(f(r,"westHemisphereGeometry")),s.push(f(r,"eastHemisphereGeometry"))),s};var T=new W.Cartesian3,N=new W.Cartesian3,O=new W.Cartesian3,L=new W.Cartesian3;t.computeNormal=function(e){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");if(!Z.defined(e.attributes.position)||!Z.defined(e.attributes.position.values))throw new M.DeveloperError("geometry.attributes.position.values is required.");if(!Z.defined(e.indices))throw new M.DeveloperError("geometry.indices is required.");if(e.indices.length<2||e.indices.length%3!=0)throw new M.DeveloperError("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==B.PrimitiveType.TRIANGLES)throw new M.DeveloperError("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var t,r=e.indices,i=e.attributes,a=i.position.values,n=i.position.values.length/3,s=r.length,o=new Array(n),u=new Array(s/3),p=new Array(s);for(t=0;t<n;t++)o[t]={indexOffset:0,count:0,currentCount:0};var d=0;for(t=0;t<s;t+=3){var v=r[t],l=r[t+1],f=r[t+2],m=3*v,y=3*l,c=3*f;N.x=a[m],N.y=a[m+1],N.z=a[m+2],O.x=a[y],O.y=a[y+1],O.z=a[y+2],L.x=a[c],L.y=a[c+1],L.z=a[c+2],o[v].count++,o[l].count++,o[f].count++,W.Cartesian3.subtract(O,N,O),W.Cartesian3.subtract(L,N,L),u[d]=W.Cartesian3.cross(O,L,new W.Cartesian3),d++}var h,C=0;for(t=0;t<n;t++)o[t].indexOffset+=C,C+=o[t].count;for(t=d=0;t<s;t+=3){var b=(h=o[r[t]]).indexOffset+h.currentCount;p[b]=d,h.currentCount++,p[b=(h=o[r[t+1]]).indexOffset+h.currentCount]=d,h.currentCount++,p[b=(h=o[r[t+2]]).indexOffset+h.currentCount]=d,h.currentCount++,d++}var w=new Float32Array(3*n);for(t=0;t<n;t++){var g=3*t;if(h=o[t],W.Cartesian3.clone(W.Cartesian3.ZERO,T),0<h.count){for(d=0;d<h.count;d++)W.Cartesian3.add(T,u[p[h.indexOffset+d]],T);W.Cartesian3.equalsEpsilon(W.Cartesian3.ZERO,T,H.CesiumMath.EPSILON10)&&W.Cartesian3.clone(u[p[h.indexOffset]],T)}W.Cartesian3.equalsEpsilon(W.Cartesian3.ZERO,T,H.CesiumMath.EPSILON10)&&(T.z=1),W.Cartesian3.normalize(T,T),w[g]=T.x,w[g+1]=T.y,w[g+2]=T.z}return e.attributes.normal=new R.GeometryAttribute({componentDatatype:q.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w}),e};var V=new W.Cartesian3,k=new W.Cartesian3,F=new W.Cartesian3;t.computeTangentAndBitangent=function(e){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");var t=e.attributes,r=e.indices;if(!Z.defined(t.position)||!Z.defined(t.position.values))throw new M.DeveloperError("geometry.attributes.position.values is required.");if(!Z.defined(t.normal)||!Z.defined(t.normal.values))throw new M.DeveloperError("geometry.attributes.normal.values is required.");if(!Z.defined(t.st)||!Z.defined(t.st.values))throw new M.DeveloperError("geometry.attributes.st.values is required.");if(!Z.defined(r))throw new M.DeveloperError("geometry.indices is required.");if(r.length<2||r.length%3!=0)throw new M.DeveloperError("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==B.PrimitiveType.TRIANGLES)throw new M.DeveloperError("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var i,a,n,s,o=e.attributes.position.values,u=e.attributes.normal.values,p=e.attributes.st.values,d=e.attributes.position.values.length/3,v=r.length,l=new Array(3*d);for(i=0;i<l.length;i++)l[i]=0;for(i=0;i<v;i+=3){var f=r[i],m=r[i+1],y=r[i+2];n=3*m,s=3*y;var c=2*f,h=2*m,C=2*y,b=o[a=3*f],w=o[a+1],g=o[a+2],T=p[c],A=p[c+1],E=p[h+1]-A,D=p[C+1]-A,x=1/((p[h]-T)*D-(p[C]-T)*E),P=(D*(o[n]-b)-E*(o[s]-b))*x,S=(D*(o[n+1]-w)-E*(o[s+1]-w))*x,I=(D*(o[n+2]-g)-E*(o[s+2]-g))*x;l[a]+=P,l[a+1]+=S,l[a+2]+=I,l[n]+=P,l[n+1]+=S,l[n+2]+=I,l[s]+=P,l[s+1]+=S,l[s+2]+=I}var N=new Float32Array(3*d),O=new Float32Array(3*d);for(i=0;i<d;i++){n=(a=3*i)+1,s=a+2;var L=W.Cartesian3.fromArray(u,a,V),z=W.Cartesian3.fromArray(l,a,F),G=W.Cartesian3.dot(L,z);W.Cartesian3.multiplyByScalar(L,G,k),W.Cartesian3.normalize(W.Cartesian3.subtract(z,k,z),z),N[a]=z.x,N[n]=z.y,N[s]=z.z,W.Cartesian3.normalize(W.Cartesian3.cross(L,z,z),z),O[a]=z.x,O[n]=z.y,O[s]=z.z}return e.attributes.tangent=new R.GeometryAttribute({componentDatatype:q.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:N}),e.attributes.bitangent=new R.GeometryAttribute({componentDatatype:q.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:O}),e};var z=new X.Cartesian2,G=new W.Cartesian3,_=new W.Cartesian3,U=new W.Cartesian3,Y=new X.Cartesian2;function C(e){switch(e.primitiveType){case B.PrimitiveType.TRIANGLE_FAN:return function(e){var t=R.Geometry.computeNumberOfVertices(e);if(t<3)throw new M.DeveloperError("The number of vertices must be at least three.");var r=P.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var i=3,a=3;a<t;++a)r[i++]=a-1,r[i++]=0,r[i++]=a;return e.indices=r,e.primitiveType=B.PrimitiveType.TRIANGLES,e}(e);case B.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=R.Geometry.computeNumberOfVertices(e);if(t<3)throw new M.DeveloperError("The number of vertices must be at least 3.");var r=P.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,3<t&&(r[3]=0,r[4]=2,r[5]=3);for(var i=6,a=3;a<t-1;a+=2)r[i++]=a,r[i++]=a-1,r[i++]=a+1,a+2<t&&(r[i++]=a,r[i++]=a+1,r[i++]=a+2);return e.indices=r,e.primitiveType=B.PrimitiveType.TRIANGLES,e}(e);case B.PrimitiveType.TRIANGLES:return function(e){if(Z.defined(e.indices))return e;var t=R.Geometry.computeNumberOfVertices(e);if(t<3)throw new M.DeveloperError("The number of vertices must be at least three.");if(t%3!=0)throw new M.DeveloperError("The number of vertices must be a multiple of three.");for(var r=P.IndexDatatype.createTypedArray(t,t),i=0;i<t;++i)r[i]=i;return e.indices=r,e}(e);case B.PrimitiveType.LINE_STRIP:return function(e){var t=R.Geometry.computeNumberOfVertices(e);if(t<2)throw new M.DeveloperError("The number of vertices must be at least two.");var r=P.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var i=2,a=2;a<t;++a)r[i++]=a-1,r[i++]=a;return e.indices=r,e.primitiveType=B.PrimitiveType.LINES,e}(e);case B.PrimitiveType.LINE_LOOP:return function(e){var t=R.Geometry.computeNumberOfVertices(e);if(t<2)throw new M.DeveloperError("The number of vertices must be at least two.");var r=P.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var i=2,a=2;a<t;++a)r[i++]=a-1,r[i++]=a;return r[i++]=t-1,r[i]=0,e.indices=r,e.primitiveType=B.PrimitiveType.LINES,e}(e);case B.PrimitiveType.LINES:return function(e){if(Z.defined(e.indices))return e;var t=R.Geometry.computeNumberOfVertices(e);if(t<2)throw new M.DeveloperError("The number of vertices must be at least two.");if(t%2!=0)throw new M.DeveloperError("The number of vertices must be a multiple of 2.");for(var r=P.IndexDatatype.createTypedArray(t,t),i=0;i<t;++i)r[i]=i;return e.indices=r,e}(e)}return e}function b(e,t){Math.abs(e.y)<H.CesiumMath.EPSILON6&&(e.y=t?-H.CesiumMath.EPSILON6:H.CesiumMath.EPSILON6)}t.compressVertices=function(e){if(!Z.defined(e))throw new M.DeveloperError("geometry is required.");var t,r,i=e.attributes.extrudeDirection;if(Z.defined(i)){var a=i.values;r=a.length/3;var n=new Float32Array(2*r),s=0;for(t=0;t<r;++t)W.Cartesian3.fromArray(a,3*t,G),W.Cartesian3.equals(G,W.Cartesian3.ZERO)?s+=2:(Y=E.AttributeCompression.octEncodeInRange(G,65535,Y),n[s++]=Y.x,n[s++]=Y.y);return e.attributes.compressedAttributes=new R.GeometryAttribute({componentDatatype:q.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:n}),delete e.attributes.extrudeDirection,e}var o=e.attributes.normal,u=e.attributes.st,p=Z.defined(o),d=Z.defined(u);if(!p&&!d)return e;var v,l,f,m,y=e.attributes.tangent,c=e.attributes.bitangent,h=Z.defined(y),C=Z.defined(c);p&&(v=o.values),d&&(l=u.values),h&&(f=y.values),C&&(m=c.values);var b=r=(p?v.length:l.length)/(p?3:2),w=d&&p?2:1;w+=h||C?1:0;var g=new Float32Array(b*=w),T=0;for(t=0;t<r;++t){d&&(X.Cartesian2.fromArray(l,2*t,z),g[T++]=E.AttributeCompression.compressTextureCoordinates(z));var A=3*t;p&&Z.defined(f)&&Z.defined(m)?(W.Cartesian3.fromArray(v,A,G),W.Cartesian3.fromArray(f,A,_),W.Cartesian3.fromArray(m,A,U),E.AttributeCompression.octPack(G,_,U,z),g[T++]=z.x,g[T++]=z.y):(p&&(W.Cartesian3.fromArray(v,A,G),g[T++]=E.AttributeCompression.octEncodeFloat(G)),h&&(W.Cartesian3.fromArray(f,A,G),g[T++]=E.AttributeCompression.octEncodeFloat(G)),C&&(W.Cartesian3.fromArray(m,A,G),g[T++]=E.AttributeCompression.octEncodeFloat(G)))}return e.attributes.compressedAttributes=new R.GeometryAttribute({componentDatatype:q.ComponentDatatype.FLOAT,componentsPerAttribute:w,values:g}),p&&delete e.attributes.normal,d&&delete e.attributes.st,C&&delete e.attributes.bitangent,h&&delete e.attributes.tangent,e};var w=new W.Cartesian3;function g(e,t,r,i){W.Cartesian3.add(e,W.Cartesian3.multiplyByScalar(W.Cartesian3.subtract(t,e,w),e.y/(e.y-t.y),w),r),W.Cartesian3.clone(r,i),b(r,!0),b(i,!1)}var K=new W.Cartesian3,Q=new W.Cartesian3,$=new W.Cartesian3,ee=new W.Cartesian3,te={positions:new Array(7),indices:new Array(9)};function re(e,t,r){if(!(0<=e.x||0<=t.x||0<=r.x)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return b(e,e.y<0),b(t,t.y<0),b(r,r.y<0);var i=Math.abs(e.y),a=Math.abs(t.y),n=Math.abs(r.y),s=(a<i?n<i?H.CesiumMath.sign(e.y):H.CesiumMath.sign(r.y):n<a?H.CesiumMath.sign(t.y):H.CesiumMath.sign(r.y))<0;b(e,s),b(t,s),b(r,s)}(e,t,r);var i=e.y<0,a=t.y<0,n=r.y<0,s=0;s+=i?1:0,s+=a?1:0,s+=n?1:0;var o=te.indices;1===s?(o[1]=3,o[2]=4,o[5]=6,o[7]=6,o[8]=5,i?(g(e,t,K,$),g(e,r,Q,ee),o[0]=0,o[3]=1,o[4]=2,o[6]=1):a?(g(t,r,K,$),g(t,e,Q,ee),o[0]=1,o[3]=2,o[4]=0,o[6]=2):n&&(g(r,e,K,$),g(r,t,Q,ee),o[0]=2,o[3]=0,o[4]=1,o[6]=0)):2===s&&(o[2]=4,o[4]=4,o[5]=3,o[7]=5,o[8]=6,i?a?n||(g(r,e,K,$),g(r,t,Q,ee),o[0]=0,o[1]=1,o[3]=0,o[6]=2):(g(t,r,K,$),g(t,e,Q,ee),o[0]=2,o[1]=0,o[3]=2,o[6]=1):(g(e,t,K,$),g(e,r,Q,ee),o[0]=1,o[1]=2,o[3]=1,o[6]=0));var u=te.positions;return u[0]=e,u[1]=t,u[2]=r,u.length=3,1!==s&&2!==s||(u[3]=K,u[4]=Q,u[5]=$,u[6]=ee,u.length=7),te}}function ie(e,t){var r=e.attributes;if(0!==r.position.values.length){for(var i in r)if(r.hasOwnProperty(i)&&Z.defined(r[i])&&Z.defined(r[i].values)){var a=r[i];a.values=q.ComponentDatatype.createTypedArray(a.componentDatatype,a.values)}var n=R.Geometry.computeNumberOfVertices(e);return e.indices=P.IndexDatatype.createTypedArray(n,e.indices),t&&(e.boundingSphere=x.BoundingSphere.fromVertices(r.position.values)),e}}function ae(e){var t=e.attributes,r={};for(var i in t)if(t.hasOwnProperty(i)&&Z.defined(t[i])&&Z.defined(t[i].values)){var a=t[i];r[i]=new R.GeometryAttribute({componentDatatype:a.componentDatatype,componentsPerAttribute:a.componentsPerAttribute,normalize:a.normalize,values:[]})}return new R.Geometry({attributes:r,indices:[],primitiveType:e.primitiveType})}function ne(e,t,r){var i=Z.defined(e.geometry.boundingSphere);t=ie(t,i),r=ie(r,i),Z.defined(r)&&!Z.defined(t)?e.geometry=r:!Z.defined(r)&&Z.defined(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=r,e.geometry=void 0)}function r(l,f){var m=new l,y=new l,c=new l;return function(e,t,r,i,a,n,s,o){var u=l.fromArray(a,e*f,m),p=l.fromArray(a,t*f,y),d=l.fromArray(a,r*f,c);l.multiplyByScalar(u,i.x,u),l.multiplyByScalar(p,i.y,p),l.multiplyByScalar(d,i.z,d);var v=l.add(u,p,u);l.add(v,d,v),o&&l.normalize(v,v),l.pack(v,n,s*f)}}var se=r(j.Cartesian4,4),oe=r(W.Cartesian3,3),ue=r(X.Cartesian2,2),pe=function(e,t,r,i,a,n,s){var o=a[e]*i.x,u=a[t]*i.y,p=a[r]*i.z;n[s]=o+u+p>H.CesiumMath.EPSILON6?1:0},de=new W.Cartesian3,ve=new W.Cartesian3,le=new W.Cartesian3,fe=new W.Cartesian3;function me(e,t,r,i,a,n,s,o,u,p,d,v,l,f,m,y){if(Z.defined(n)||Z.defined(s)||Z.defined(o)||Z.defined(u)||Z.defined(p)||0!==f){var c=function(e,t,r,i,a){var n,s,o,u,p,d,v,l;if(M.Check.defined("point",e),M.Check.defined("p0",t),M.Check.defined("p1",r),M.Check.defined("p2",i),Z.defined(a)||(a=new W.Cartesian3),Z.defined(t.z)){if(W.Cartesian3.equalsEpsilon(e,t,H.CesiumMath.EPSILON14))return W.Cartesian3.clone(W.Cartesian3.UNIT_X,a);if(W.Cartesian3.equalsEpsilon(e,r,H.CesiumMath.EPSILON14))return W.Cartesian3.clone(W.Cartesian3.UNIT_Y,a);if(W.Cartesian3.equalsEpsilon(e,i,H.CesiumMath.EPSILON14))return W.Cartesian3.clone(W.Cartesian3.UNIT_Z,a);n=W.Cartesian3.subtract(r,t,A),s=W.Cartesian3.subtract(i,t,D),o=W.Cartesian3.subtract(e,t,S),u=W.Cartesian3.dot(n,n),p=W.Cartesian3.dot(n,s),d=W.Cartesian3.dot(n,o),v=W.Cartesian3.dot(s,s),l=W.Cartesian3.dot(s,o)}else{if(X.Cartesian2.equalsEpsilon(e,t,H.CesiumMath.EPSILON14))return W.Cartesian3.clone(W.Cartesian3.UNIT_X,a);if(X.Cartesian2.equalsEpsilon(e,r,H.CesiumMath.EPSILON14))return W.Cartesian3.clone(W.Cartesian3.UNIT_Y,a);if(X.Cartesian2.equalsEpsilon(e,i,H.CesiumMath.EPSILON14))return W.Cartesian3.clone(W.Cartesian3.UNIT_Z,a);n=X.Cartesian2.subtract(r,t,A),s=X.Cartesian2.subtract(i,t,D),o=X.Cartesian2.subtract(e,t,S),u=X.Cartesian2.dot(n,n),p=X.Cartesian2.dot(n,s),d=X.Cartesian2.dot(n,o),v=X.Cartesian2.dot(s,s),l=X.Cartesian2.dot(s,o)}a.y=v*d-p*l,a.z=u*l-p*d;var f=u*v-p*p;return 0!==a.y&&(a.y/=f),0!==a.z&&(a.z/=f),a.x=1-a.y-a.z,a}(i,W.Cartesian3.fromArray(a,3*e,de),W.Cartesian3.fromArray(a,3*t,ve),W.Cartesian3.fromArray(a,3*r,le),fe);if(Z.defined(n)&&oe(e,t,r,c,n,v.normal.values,y,!0),Z.defined(p)){var h,C=W.Cartesian3.fromArray(p,3*e,de),b=W.Cartesian3.fromArray(p,3*t,ve),w=W.Cartesian3.fromArray(p,3*r,le);W.Cartesian3.multiplyByScalar(C,c.x,C),W.Cartesian3.multiplyByScalar(b,c.y,b),W.Cartesian3.multiplyByScalar(w,c.z,w),W.Cartesian3.equals(C,W.Cartesian3.ZERO)&&W.Cartesian3.equals(b,W.Cartesian3.ZERO)&&W.Cartesian3.equals(w,W.Cartesian3.ZERO)?((h=de).x=0,h.y=0,h.z=0):(h=W.Cartesian3.add(C,b,C),W.Cartesian3.add(h,w,h),W.Cartesian3.normalize(h,h)),W.Cartesian3.pack(h,v.extrudeDirection.values,3*y)}if(Z.defined(d)&&pe(e,t,r,c,d,v.applyOffset.values,y),Z.defined(s)&&oe(e,t,r,c,s,v.tangent.values,y,!0),Z.defined(o)&&oe(e,t,r,c,o,v.bitangent.values,y,!0),Z.defined(u)&&ue(e,t,r,c,u,v.st.values,y),0<f)for(var g=0;g<f;g++){var T=l[g];ye(e,t,r,c,y,m[T],v[T])}}}function ye(e,t,r,i,a,n,s){var o=n.componentsPerAttribute,u=n.values,p=s.values;switch(o){case 4:se(e,t,r,i,u,p,a,!1);break;case 3:oe(e,t,r,i,u,p,a,!1);break;case 2:ue(e,t,r,i,u,p,a,!1);break;default:p[a]=u[e]*i.x+u[t]*i.y+u[r]*i.z}}function ce(e,t,r,i,a,n){var s=e.position.values.length/3;if(-1===a)return e.position.values.push(n.x,n.y,n.z),t.push(s),s;var o=i[a],u=r[o];return-1===u?(r[o]=s,e.position.values.push(n.x,n.y,n.z),t.push(s),s):(t.push(u),u)}var he={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function Ce(e){var t=e.geometry,r=t.attributes,i=r.position.values,a=Z.defined(r.normal)?r.normal.values:void 0,n=Z.defined(r.bitangent)?r.bitangent.values:void 0,s=Z.defined(r.tangent)?r.tangent.values:void 0,o=Z.defined(r.st)?r.st.values:void 0,u=Z.defined(r.extrudeDirection)?r.extrudeDirection.values:void 0,p=Z.defined(r.applyOffset)?r.applyOffset.values:void 0,d=t.indices,v=[];for(var l in r)r.hasOwnProperty(l)&&!he[l]&&Z.defined(r[l])&&v.push(l);var f,m,y,c,h=v.length,C=ae(t),b=ae(t),w=[];w.length=i.length/3;var g=[];for(g.length=i.length/3,c=0;c<w.length;++c)w[c]=-1,g[c]=-1;var T=d.length;for(c=0;c<T;c+=3){var A=d[c],E=d[c+1],D=d[c+2],x=W.Cartesian3.fromArray(i,3*A),P=W.Cartesian3.fromArray(i,3*E),S=W.Cartesian3.fromArray(i,3*D),I=re(x,P,S);if(Z.defined(I)&&3<I.positions.length)for(var N=I.positions,O=I.indices,L=O.length,z=0;z<L;++z){var G=O[z],M=N[G];me(A,E,D,M,i,a,s,n,o,u,p,f,v,h,r,ce(f,m,y=M.y<0?(f=b.attributes,m=b.indices,w):(f=C.attributes,m=C.indices,g),d,G<3?c+G:-1,M))}else Z.defined(I)&&(x=I.positions[0],P=I.positions[1],S=I.positions[2]),me(A,E,D,x,i,a,s,n,o,u,p,f,v,h,r,ce(f,m,y=x.y<0?(f=b.attributes,m=b.indices,w):(f=C.attributes,m=C.indices,g),d,c,x)),me(A,E,D,P,i,a,s,n,o,u,p,f,v,h,r,ce(f,m,y,d,c+1,P)),me(A,E,D,S,i,a,s,n,o,u,p,f,v,h,r,ce(f,m,y,d,c+2,S))}ne(e,b,C)}var be=i.Plane.fromPointNormal(W.Cartesian3.ZERO,W.Cartesian3.UNIT_Y),we=new W.Cartesian3,ge=new W.Cartesian3;function Te(e,t,r,i,a,n,s){if(Z.defined(s)){var o=W.Cartesian3.fromArray(i,3*e,de);W.Cartesian3.equalsEpsilon(o,r,H.CesiumMath.EPSILON10)?n.applyOffset.values[a]=s[e]:n.applyOffset.values[a]=s[t]}}function Ae(e){var t,r=e.geometry,i=r.attributes,a=i.position.values,n=Z.defined(i.applyOffset)?i.applyOffset.values:void 0,s=r.indices,o=ae(r),u=ae(r),p=s.length,d=[];d.length=a.length/3;var v=[];for(v.length=a.length/3,t=0;t<d.length;++t)d[t]=-1,v[t]=-1;for(t=0;t<p;t+=2){var l=s[t],f=s[t+1],m=W.Cartesian3.fromArray(a,3*l,de),y=W.Cartesian3.fromArray(a,3*f,ve);Math.abs(m.y)<H.CesiumMath.EPSILON6&&(m.y<0?m.y=-H.CesiumMath.EPSILON6:m.y=H.CesiumMath.EPSILON6),Math.abs(y.y)<H.CesiumMath.EPSILON6&&(y.y<0?y.y=-H.CesiumMath.EPSILON6:y.y=H.CesiumMath.EPSILON6);var c=o.attributes,h=o.indices,C=v,b=u.attributes,w=u.indices,g=d,T=J.IntersectionTests.lineSegmentPlane(m,y,be,le);if(Z.defined(T)){var A=W.Cartesian3.multiplyByScalar(W.Cartesian3.UNIT_Y,5*H.CesiumMath.EPSILON9,we);m.y<0&&(W.Cartesian3.negate(A,A),c=u.attributes,h=u.indices,C=d,b=o.attributes,w=o.indices,g=v);var E=W.Cartesian3.add(T,A,ge);Te(l,f,m,a,ce(c,h,C,s,t,m),c,n),Te(l,f,E,a,ce(c,h,C,s,-1,E),c,n),W.Cartesian3.negate(A,A),W.Cartesian3.add(T,A,E),Te(l,f,E,a,ce(b,w,g,s,-1,E),b,n),Te(l,f,y,a,ce(b,w,g,s,t+1,y),b,n)}else{var D,x,P;Te(l,f,m,a,ce(D,x,P=m.y<0?(D=u.attributes,x=u.indices,d):(D=o.attributes,x=o.indices,v),s,t,m),D,n),Te(l,f,y,a,ce(D,x,P,s,t+1,y),D,n)}}ne(e,u,o)}var Ee=new X.Cartesian2,De=new X.Cartesian2,xe=new W.Cartesian3,Pe=new W.Cartesian3,Se=new W.Cartesian3,Ie=new W.Cartesian3,Ne=new W.Cartesian3,Oe=new W.Cartesian3,Le=new W.Cartesian3,ze=new j.Cartesian4;function Ge(e){for(var t=e.attributes,r=t.position.values,i=t.prevPosition.values,a=t.nextPosition.values,n=r.length,s=0;s<n;s+=3){var o=W.Cartesian3.unpack(r,s,xe);if(!(0<o.x)){var u=W.Cartesian3.unpack(i,s,Pe);(o.y<0&&0<u.y||0<o.y&&u.y<0)&&(0<s-3?(i[s]=r[s-3],i[s+1]=r[s-2],i[s+2]=r[s-1]):W.Cartesian3.pack(o,i,s));var p=W.Cartesian3.unpack(a,s,Se);(o.y<0&&0<p.y||0<o.y&&p.y<0)&&(s+3<n?(a[s]=r[s+3],a[s+1]=r[s+4],a[s+2]=r[s+5]):W.Cartesian3.pack(o,a,s))}}}var Me=5*H.CesiumMath.EPSILON9,qe=H.CesiumMath.EPSILON6;t.splitLongitude=function(e){if(!Z.defined(e))throw new M.DeveloperError("instance is required.");var t=e.geometry,r=t.boundingSphere;if(Z.defined(r)&&(0<r.center.x-r.radius||x.BoundingSphere.intersectPlane(r,i.Plane.ORIGIN_ZX_PLANE)!==x.Intersect.INTERSECTING))return e;if(t.geometryType!==R.GeometryType.NONE)switch(t.geometryType){case R.GeometryType.POLYLINES:!function(e){var t,r,i,a=e.geometry,n=a.attributes,s=n.position.values,o=n.prevPosition.values,u=n.nextPosition.values,p=n.expandAndWidth.values,d=Z.defined(n.st)?n.st.values:void 0,v=Z.defined(n.color)?n.color.values:void 0,l=Z.defined(n.dist)?n.dist.values:void 0,f=ae(a),m=ae(a),y=!1,c=s.length/3;for(t=0;t<c;t+=4){var h=t,C=t+2,b=W.Cartesian3.fromArray(s,3*h,xe),w=W.Cartesian3.fromArray(s,3*C,Pe);if(Math.abs(b.y)<qe)for(b.y=qe*(w.y<0?-1:1),s[3*t+1]=b.y,s[3*(t+1)+1]=b.y,r=3*h;r<3*h+12;r+=3)o[r]=s[3*t],o[r+1]=s[3*t+1],o[r+2]=s[3*t+2];if(Math.abs(w.y)<qe)for(w.y=qe*(b.y<0?-1:1),s[3*(t+2)+1]=w.y,s[3*(t+3)+1]=w.y,r=3*h;r<3*h+12;r+=3)u[r]=s[3*(t+2)],u[r+1]=s[3*(t+2)+1],u[r+2]=s[3*(t+2)+2];var g=f.attributes,T=f.indices,A=m.attributes,E=m.indices,D=J.IntersectionTests.lineSegmentPlane(b,w,be,Ie);if(Z.defined(D)){y=!0;var x=W.Cartesian3.multiplyByScalar(W.Cartesian3.UNIT_Y,Me,Ne);b.y<0&&(W.Cartesian3.negate(x,x),g=m.attributes,T=m.indices,A=f.attributes,E=f.indices);var P=W.Cartesian3.add(D,x,Oe);g.position.values.push(b.x,b.y,b.z,b.x,b.y,b.z),g.position.values.push(P.x,P.y,P.z),g.position.values.push(P.x,P.y,P.z),g.prevPosition.values.push(o[3*h],o[3*h+1],o[3*h+2]),g.prevPosition.values.push(o[3*h+3],o[3*h+4],o[3*h+5]),g.prevPosition.values.push(b.x,b.y,b.z,b.x,b.y,b.z),g.nextPosition.values.push(P.x,P.y,P.z),g.nextPosition.values.push(P.x,P.y,P.z),g.nextPosition.values.push(P.x,P.y,P.z),g.nextPosition.values.push(P.x,P.y,P.z),W.Cartesian3.negate(x,x),W.Cartesian3.add(D,x,P),A.position.values.push(P.x,P.y,P.z),A.position.values.push(P.x,P.y,P.z),A.position.values.push(w.x,w.y,w.z,w.x,w.y,w.z),A.prevPosition.values.push(P.x,P.y,P.z),A.prevPosition.values.push(P.x,P.y,P.z),A.prevPosition.values.push(P.x,P.y,P.z),A.prevPosition.values.push(P.x,P.y,P.z),A.nextPosition.values.push(w.x,w.y,w.z,w.x,w.y,w.z),A.nextPosition.values.push(u[3*C],u[3*C+1],u[3*C+2]),A.nextPosition.values.push(u[3*C+3],u[3*C+4],u[3*C+5]);var S=X.Cartesian2.fromArray(p,2*h,Ee),I=Math.abs(S.y);g.expandAndWidth.values.push(-1,I,1,I),g.expandAndWidth.values.push(-1,-I,1,-I),A.expandAndWidth.values.push(-1,I,1,I),A.expandAndWidth.values.push(-1,-I,1,-I);var N=W.Cartesian3.magnitudeSquared(W.Cartesian3.subtract(D,b,Se));if(N/=W.Cartesian3.magnitudeSquared(W.Cartesian3.subtract(w,b,Se)),Z.defined(v)){var O=j.Cartesian4.fromArray(v,4*h,ze),L=j.Cartesian4.fromArray(v,4*C,ze),z=H.CesiumMath.lerp(O.x,L.x,N),G=H.CesiumMath.lerp(O.y,L.y,N),M=H.CesiumMath.lerp(O.z,L.z,N),q=H.CesiumMath.lerp(O.w,L.w,N);for(r=4*h;r<4*h+8;++r)g.color.values.push(v[r]);for(g.color.values.push(z,G,M,q),g.color.values.push(z,G,M,q),A.color.values.push(z,G,M,q),A.color.values.push(z,G,M,q),r=4*C;r<4*C+8;++r)A.color.values.push(v[r])}if(Z.defined(d)){var R=X.Cartesian2.fromArray(d,2*h,Ee),B=X.Cartesian2.fromArray(d,2*(t+3),De),V=H.CesiumMath.lerp(R.x,B.x,N);for(r=2*h;r<2*h+4;++r)g.st.values.push(d[r]);for(g.st.values.push(V,R.y),g.st.values.push(V,B.y),A.st.values.push(V,R.y),A.st.values.push(V,B.y),r=2*C;r<2*C+4;++r)A.st.values.push(d[r])}if(Z.defined(l)){var k=W.Cartesian3.fromArray(l,3*h,Le),F=W.Cartesian3.fromArray(l,3*C,Le),_=H.CesiumMath.lerp(k.x,F.x,N);for(r=3*h;r<3*h+6;++r)g.dist.values.push(l[r]);for(g.dist.values.push(_,k.y,k.z),g.dist.values.push(_,k.y,k.z),A.dist.values.push(_,F.y,F.z),A.dist.values.push(_,F.y,F.z),r=3*C;r<3*C+6;++r)A.dist.values.push(l[r])}i=g.position.values.length/3-4,T.push(i,i+2,i+1),T.push(i+1,i+2,i+3),i=A.position.values.length/3-4,E.push(i,i+2,i+1),E.push(i+1,i+2,i+3)}else{var U,Y;for(Y=b.y<0?(U=m.attributes,m.indices):(U=f.attributes,f.indices),U.position.values.push(b.x,b.y,b.z),U.position.values.push(b.x,b.y,b.z),U.position.values.push(w.x,w.y,w.z),U.position.values.push(w.x,w.y,w.z),r=3*t;r<3*t+12;++r)U.prevPosition.values.push(o[r]),U.nextPosition.values.push(u[r]);for(r=2*t;r<2*t+8;++r)U.expandAndWidth.values.push(p[r]),Z.defined(d)&&U.st.values.push(d[r]);if(Z.defined(v))for(r=4*t;r<4*t+16;++r)U.color.values.push(v[r]);if(Z.defined(l))for(r=3*t;r<3*t+12;++r)U.dist.values.push(l[r]);i=U.position.values.length/3-4,Y.push(i,i+2,i+1),Y.push(i+1,i+2,i+3)}}y&&(Ge(m),Ge(f)),ne(e,m,f)}(e);break;case R.GeometryType.TRIANGLES:Ce(e);break;case R.GeometryType.LINES:Ae(e)}else C(t),t.primitiveType===B.PrimitiveType.TRIANGLES?Ce(e):t.primitiveType===B.PrimitiveType.LINES&&Ae(e);return e},e.GeometryPipeline=t});